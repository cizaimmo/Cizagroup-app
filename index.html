<!DOCTYPE html>
<html lang="fr">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CIZA GROUP — App</title>
<link rel="icon" href="icon-512.png">

<style>
/* GLOBAL */
body{
    margin:0;
    background:#06142E;
    color:white;
    font-family:Arial, sans-serif;
    overflow:hidden;
}

/* SPLASH SCREEN */
#splash{
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    background:#06142E;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    animation:fadeOut 1.4s ease 2.8s forwards;
}

#splash img{
    width:140px;
    opacity:0;
    animation:logoFade 1.9s ease forwards;
}

#splash p{
    margin-top:15px;
    font-size:14px;
    opacity:0;
    color:#F2B840;
    animation:txtFade 1.8s ease 1.4s forwards;
}

@keyframes logoFade{
    0%{opacity:0; transform:scale(0.75);}
    100%{opacity:1; transform:scale(1);}
}
@keyframes txtFade{
    0%{opacity:0;}
    100%{opacity:0.75;}
}
@keyframes fadeOut{
    to{opacity:0; visibility:hidden;}
}

/* HEADER */
header{
    display:none;
    background:#06142E;
    padding:18px;
    text-align:center;
    color:white;
    border-bottom:2px solid #F2B840;
}

/* MAIN */
#main{
    display:none;
    padding:20px;
}

.menu{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    justify-content:center;
    margin-top:20px;
}
.menu button{
    background:#F2B840;
    border:none;
    padding:14px 20px;
    border-radius:10px;
    font-weight:bold;
    color:#06142E;
    cursor:pointer;
}
.menu button:hover{
    background:#cfa035;
}

/* POPUP BASE */
.popup{
    display:none;
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    background:#000000AA;
    backdrop-filter:blur(6px);
    justify-content:center;
    align-items:center;
    z-index:9999;
}
.popup-content{
    background:#0B1C34;
    padding:25px;
    width:90%;
    max-width:330px;
    border-radius:14px;
    border:1px solid #12335c;
    color:white;
    text-align:center;
}
.popup-content input{
    width:100%;
    padding:12px;
    margin-top:10px;
    background:#112544;
    border:none;
    border-radius:8px;
    color:white;
}
.popup-content button{
    width:100%;
    padding:12px;
    margin-top:14px;
    border:none;
    border-radius:8px;
    background:#F2B840;
    color:#06142E;
    font-weight:bold;
    cursor:pointer;
}
.close{
    float:right;
    cursor:pointer;
    font-size:22px;
    color:#F2B840;
}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash">
    <img src="app-logo.png" alt="CIZA GROUP">
    <p>App officielle — CIZA GROUP</p>
</div>

<!-- HEADER -->
<header id="header">
    <h2>CIZA GROUP — App</h2>
</header>

<!-- MAIN -->
<div id="main">

    <h2 style="text-align:center;margin-top:10px;">Choisissez un service</h2>

    <div class="menu">
        <button onclick="requireLogin()">CizaCarWash+</button>
        <button onclick="requireLogin()">CizaDelivery</button>
        <button onclick="requireLogin()">CizaAssist</button>
        <button onclick="requireLogin()">CizaMarket</button>
        <button onclick="requireLogin()">CizaJobs</button>
    </div>
</div>

<!-- POPUP LOGIN -->
<div id="popup-login" class="popup">
    <div class="popup-content">
        <span class="close" onclick="closePopup('login')">&times;</span>
        <h2>Connexion</h2>

        <input type="email" id="login-email" placeholder="Email">
        <input type="password" id="login-password" placeholder="Mot de passe">

        <button onclick="loginUser()">Se connecter</button>

        <p style="opacity:.7;font-size:14px;margin-top:10px;">
            Pas de compte ? <a href="#" onclick="switchPopup('login','register')">Créer un compte</a>
        </p>
    </div>
</div>

<!-- POPUP REGISTER -->
<div id="popup-register" class="popup">
    <div class="popup-content">
        <span class="close" onclick="closePopup('register')">&times;</span>

        <h2>Créer un compte</h2>

        <input type="email" id="reg-email" placeholder="Email">
        <input type="text" id="reg-phone" placeholder="Téléphone (+257...)">
        <input type="password" id="reg-password" placeholder="Mot de passe">

        <button onclick="registerUser()">Créer un compte</button>

        <p style="opacity:.7;font-size:14px;margin-top:10px;">
            Déjà un compte ? <a href="#" onclick="switchPopup('register','login')">Connexion</a>
        </p>
    </div>
</div>

<script>
setTimeout(()=>{
    document.getElementById("splash").style.display="none";
    document.getElementById("header").style.display="block";
    document.getElementById("main").style.display="block";
}, 3000);

/* POPUP FUNCTIONS */
function requireLogin(){ openPopup("login"); }
function openPopup(id){ document.getElementById("popup-"+id).style.display="flex"; }
function closePopup(id){ document.getElementById("popup-"+id).style.display="none"; }
function switchPopup(oldPopup,newPopup){ closePopup(oldPopup); openPopup(newPopup); }
</script>


<!-- ===========================
        FIREBASE AUTH + FIRESTORE
=========================== -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { 
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword 
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

import {
    getFirestore,
    doc,
    setDoc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

/* CONFIG FIREBASE */
const firebaseConfig = {
    apiKey: "AIzaSyBAiJHbBvRO6cDFpm6C-5mQk6SiTtzcI8o",
    authDomain: "cizagroup-app.firebaseapp.com",
    projectId: "cizagroup-app",
    storageBucket: "cizagroup-app.firebasestorage.app",
    messagingSenderId: "930936264084",
    appId: "1:930936264084:web:5395360e54bf17bf492b81",
    measurementId: "G-1KX6EN1KST"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

/* VALIDATION TÉLÉPHONE */
function validatePhone(num){
    const regex = /^\+[0-9]{8,15}$/;
    return regex.test(num);
}

/* REGISTER */
window.registerUser = async function(){

    const email    = document.getElementById("reg-email").value;
    const password = document.getElementById("reg-password").value;
    const phone    = document.getElementById("reg-phone").value;

    if(!email || !password || !phone){
        alert("Veuillez remplir tous les champs.");
        return;
    }

    if(!validatePhone(phone)){
        alert("Format téléphone invalide. Exemple : +25779900000");
        return;
    }

    try {
        const user = await createUserWithEmailAndPassword(auth, email, password);

        await setDoc(doc(db, "users", user.user.uid), {
            email: email,
            phone: phone,
            createdAt: new Date().toISOString()
        });

        alert("Compte créé avec succès !");
        closePopup('register');
        openPopup('login');
    } 
    catch(err){
        alert("Erreur : " + err.message);
    }
};

/* LOGIN */
window.loginUser = async function(){

    const email    = document.getElementById("login-email").value;
    const password = document.getElementById("login-password").value;

    try {
        await signInWithEmailAndPassword(auth, email, password);
        alert("Connexion réussie !");
        closePopup('login');
    } 
    catch(err){
        alert("Erreur : " + err.message);
    }
};

</script>

</body>
</html>
