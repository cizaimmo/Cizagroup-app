<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaDelivery+ â€” Suivi GPS</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{
  margin:0;
  background:#06142E;
  color:white;
  font-family:Arial,sans-serif;
}
header{
  padding:14px;
  text-align:center;
  background:#0B1C34;
  border-bottom:2px solid #F2B840;
}
#map{
  height:80vh;
  width:100%;
}
.info{
  padding:14px;
  background:#0B1C34;
}
.status{
  color:#F2B840;
  font-weight:bold;
}
</style>
</head>

<body>

<header>
  <h2>ðŸ“¦ Suivi CizaDelivery+</h2>
</header>

<div id="map"></div>

<div class="info">
  <div>Commande : <span id="orderId"></span></div>
  <div>Statut : <span class="status" id="status">Connexion...</span></div>
  <div>DerniÃ¨re position : <span id="time"></span></div>
</div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ðŸ” CONFIG FIREBASE (Ã€ REMPLACER)
const firebaseConfig = {
  apiKey: "TA_CLE_API",
  authDomain: "ciza-delivery.firebaseapp.com",
  projectId: "ciza-delivery",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ðŸ“¦ ID COMMANDE
const params = new URLSearchParams(window.location.search);
const orderId = params.get("order");
document.getElementById("orderId").textContent = orderId || "Inconnu";

// ðŸ—ºï¸ MAP
const map = L.map('map').setView([-3.3614, 29.3599], 13); // Bujumbura
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19
}).addTo(map);

let marker = L.marker([-3.3614, 29.3599]).addTo(map);

// ðŸ” GPS LIVE
db.collection("deliveries").doc(orderId)
.onSnapshot(doc=>{
  if(!doc.exists) return;

  const d = doc.data();
  marker.setLatLng([d.lat, d.lng]);
  map.setView([d.lat, d.lng], 15);

  document.getElementById("status").textContent = d.status;
  document.getElementById("time").textContent =
    new Date(d.updatedAt.seconds*1000).toLocaleTimeString();
});
</script>

</body>
</html>
