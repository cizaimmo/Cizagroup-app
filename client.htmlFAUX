<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaRide+ â€” Carte Client</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{
  margin:0;height:100%;
  font-family:Arial;background:#06142E;
}
#map{height:100%}

/* Bottom sheet */
#panel{
  position:fixed;
  bottom:12px;left:50%;
  transform:translateX(-50%);
  width:94%;
  background:#0B1D3A;
  color:white;
  padding:16px;
  border-radius:20px;
  z-index:999;
}

.row{margin:8px 0;font-size:15px}
.price{color:#F2B840;font-size:20px;font-weight:bold;margin-top:10px}
button{
  width:100%;margin-top:12px;
  padding:14px;border:none;border-radius:25px;
  background:#F2B840;color:#06142E;
  font-size:16px;font-weight:bold;
}
button:disabled{background:#777}
</style>
</head>

<body>

<div id="map"></div>

<div id="panel">
  <div class="row" id="start"></div>
  <div class="row" id="dest"></div>
  <div class="row" id="distance"></div>
  <div class="price" id="price"></div>
  <button id="order" disabled>ðŸš— Commander la course</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map=L.map('map').setView([-3.3614,29.3599],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

let startPos=null, endPos=null;
let startMarker, endMarker;

/* 1ï¸âƒ£ DÃ©part rÃ©el (gÃ©olocalisation) */
navigator.geolocation.getCurrentPosition(p=>{
  startPos=[p.coords.latitude,p.coords.longitude];
  startMarker=L.marker(startPos).addTo(map);
  map.setView(startPos,15);
  document.getElementById("start").textContent =
    "ðŸ“ DÃ©part : position actuelle";
});

/* 2ï¸âƒ£ Destination rÃ©elle (clic carte) */
map.on('click',e=>{
  if(!startPos) return;

  endPos=[e.latlng.lat,e.latlng.lng];

  if(endMarker) map.removeLayer(endMarker);
  endMarker=L.marker(endPos).addTo(map);

  document.getElementById("dest").textContent =
    "ðŸŽ¯ Destination : sÃ©lectionnÃ©e";

  calculate();
});

/* 3ï¸âƒ£ Calcul rÃ©el */
function calculate(){
  const dx=startPos[0]-endPos[0];
  const dy=startPos[1]-endPos[1];
  const km=(Math.sqrt(dx*dx+dy*dy)*111).toFixed(2);

  document.getElementById("distance").textContent =
    "ðŸ“ Distance : "+km+" km";

  const price=Math.round(2000 + km*1000);
  document.getElementById("price").textContent =
    "ðŸ’° Prix : "+price+" BIF";

  document.getElementById("order").disabled=false;
}

/* 4ï¸âƒ£ Commander */
document.getElementById("order").onclick=()=>{
  alert("Course envoyÃ©e au chauffeur (test)");
};
</script>

</body>
</html>
