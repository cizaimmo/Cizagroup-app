<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CizaRide+ â€” Carte Client</title>
<link rel="icon" href="logotransparent.png">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;width:100%;height:100%;
  overflow:hidden;font-family:Arial,sans-serif;
  background:#06142E;
}

/* HEADER */
header{
  position:absolute;top:0;left:0;right:0;
  z-index:1000;
  background:#06142E;color:#F2B840;
  padding:14px 18px;
  border-bottom:1px solid #F2B840;
}

/* MAP */
#map{position:absolute;inset:0}

/* CENTER PIN */
#centerPin{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-100%);
  font-size:38px;
  z-index:900;
  pointer-events:none;
}

/* PANEL */
#panel{
  position:absolute;
  bottom:14px;left:50%;
  transform:translateX(-50%);
  width:94%;
  background:rgba(6,20,46,.95);
  color:white;padding:16px;
  border-radius:22px;
  z-index:1000;
}

.row{padding:10px;border-bottom:1px solid rgba(255,255,255,.1)}
.price{font-size:22px;color:#F2B840;text-align:center;margin:10px 0}

button{
  width:100%;padding:16px;border:none;
  border-radius:30px;
  background:#F2B840;color:#06142E;
  font-size:18px;font-weight:bold;
}
button.secondary{
  background:#444;color:white;margin-bottom:8px;
}
button:disabled{background:#777}
</style>
</head>

<body>

<header>Client â€” Commander un trajet</header>

<div id="map"></div>
<div id="centerPin">ğŸ“</div>

<div id="panel">
  <div class="row">ğŸ“ DÃ©part : position actuelle</div>
  <div class="row" id="destTxt">ğŸ¯ Destination : dÃ©placer la carte</div>
  <div class="row" id="distance">ğŸ“ Distance : â€”</div>
  <div class="row" id="time">â± DurÃ©e estimÃ©e : â€”</div>
  <div class="price" id="price">ğŸ’° Prix : â€”</div>

  <button class="secondary" id="confirmDest">
    ğŸ“ Confirmer la destination
  </button>

  <button id="order" disabled>ğŸš— Commander la course</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map,startPos,endPos;

/* MAP */
map=L.map('map').setView([-3.3614,29.3599],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

/* DÃ‰PART */
navigator.geolocation.getCurrentPosition(p=>{
  startPos=[p.coords.latitude,p.coords.longitude];
  L.marker(startPos).addTo(map).bindPopup("DÃ©part").openPopup();
  map.setView(startPos,15);
});

/* CONFIRM DESTINATION */
document.getElementById("confirmDest").onclick=()=>{
  const c=map.getCenter();
  endPos=[c.lat,c.lng];
  document.getElementById("destTxt").textContent="ğŸ¯ Destination : confirmÃ©e";
  calculate();
};

/* CALCUL */
function calculate(){
  if(!startPos||!endPos) return;

  const url="https://router.project-osrm.org/route/v1/driving/"
    +startPos[1]+","+startPos[0]+";"
    +endPos[1]+","+endPos[0]
    +"?overview=false";

  fetch(url).then(r=>r.json()).then(d=>{
    const r=d.routes[0];
    const km=(r.distance/1000).toFixed(2);
    const min=Math.ceil(r.duration/60);

    document.getElementById("distance").textContent="ğŸ“ Distance : "+km+" km";
    document.getElementById("time").textContent="â± DurÃ©e estimÃ©e : "+min+" min";

    const price=Math.round(2000+km*1000);
    document.getElementById("price").textContent="ğŸ’° Prix : "+price+" BIF";
    document.getElementById("order").disabled=false;
  });
}

document.getElementById("order").onclick=()=>{
  alert("ğŸš• Course envoyÃ©e aux chauffeurs");
};
</script>

</body>
</html>
