<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CizaRide+ â€” Commander un trajet</title>
<link rel="icon" href="logotransparent.png">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  background:#06142E;font-family:Arial;
}

#map{height:100%}

/* SEARCH PANEL */
#panel{
  position:fixed;
  bottom:12px;left:50%;
  transform:translateX(-50%);
  width:94%;
  background:#0B1D3A;
  color:white;
  padding:16px;
  border-radius:18px;
  z-index:999;
}

input{
  width:100%;
  padding:12px;
  margin-bottom:8px;
  border-radius:10px;
  border:none;
  font-size:15px;
}

.result{
  background:#122A52;
  padding:8px;
  margin-top:4px;
  border-radius:8px;
  cursor:pointer;
}

.price{
  color:#F2B840;
  font-size:20px;
  font-weight:bold;
  margin:8px 0;
}

button{
  width:100%;
  padding:14px;
  background:#F2B840;
  color:#06142E;
  border:none;
  border-radius:25px;
  font-size:16px;
  font-weight:bold;
}
button:disabled{background:#777}
</style>
</head>

<body>

<div id="map"></div>

<div id="panel">
  <input id="destInput" placeholder="ğŸ¯ OÃ¹ allez-vous ?" />
  <div id="results"></div>

  <div id="distance">ğŸ“ Distance : â€”</div>
  <div class="price" id="price">ğŸ’° Prix : â€”</div>

  <button id="order" disabled>ğŸš— Commander la course</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map=L.map('map').setView([-3.3614,29.3599],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let startPos=null, endPos=null;
let startMarker, endMarker;

/* POSITION CLIENT */
navigator.geolocation.getCurrentPosition(p=>{
  startPos=[p.coords.latitude,p.coords.longitude];
  startMarker=L.marker(startPos).addTo(map)
    .bindPopup("DÃ©part").openPopup();
  map.setView(startPos,15);
});

/* SEARCH DESTINATION */
const input=document.getElementById("destInput");
const results=document.getElementById("results");

input.oninput=()=>{
  const q=input.value;
  if(q.length<3){results.innerHTML="";return;}

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${q}`)
    .then(r=>r.json())
    .then(data=>{
      results.innerHTML="";
      data.slice(0,5).forEach(p=>{
        const div=document.createElement("div");
        div.className="result";
        div.textContent=p.display_name;
        div.onclick=()=>{
          endPos=[parseFloat(p.lat),parseFloat(p.lon)];
          if(endMarker) map.removeLayer(endMarker);
          endMarker=L.marker(endPos).addTo(map)
            .bindPopup("Destination").openPopup();
          map.setView(endPos,15);
          results.innerHTML="";
          calculate();
        };
        results.appendChild(div);
      });
    });
};

/* CALCUL DISTANCE + PRIX */
function calculate(){
  if(!startPos||!endPos) return;

  const url="https://router.project-osrm.org/route/v1/driving/"
    +startPos[1]+","+startPos[0]+";"
    +endPos[1]+","+endPos[0]
    +"?overview=false";

  fetch(url).then(r=>r.json()).then(d=>{
    const r=d.routes[0];
    const km=(r.distance/1000).toFixed(2);
    document.getElementById("distance").textContent="ğŸ“ Distance : "+km+" km";

    const price=Math.round(2000+km*1000);
    document.getElementById("price").textContent="ğŸ’° Prix : "+price+" BIF";
    document.getElementById("order").disabled=false;
  });
}

document.getElementById("order").onclick=()=>{
  alert("ğŸš• Course envoyÃ©e aux chauffeurs");
};
</script>

</body>
</html>
