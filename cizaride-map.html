<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CizaRide+ — Commander une course</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#06142E;
    color:white;
}

/* HEADER */
header{
    position:sticky;
    top:0;
    z-index:1000;
    background:rgba(6,20,46,0.9);
    backdrop-filter:blur(12px);
    border-bottom:2px solid #F2B840;
    padding:14px 18px;
    display:flex;
    align-items:center;
    justify-content:space-between;
}
header h1{
    font-size:18px;
    margin:0;
    color:#F2B840;
}
header button{
    background:none;
    border:2px solid #F2B840;
    color:#F2B840;
    padding:6px 12px;
    border-radius:10px;
    cursor:pointer;
}

/* MAP */
#map{
    height:55vh;
    width:100%;
}

/* PANEL */
.panel{
    padding:20px;
}
.panel h2{
    color:#F2B840;
    margin-top:0;
}

/* INPUTS */
input{
    width:100%;
    padding:14px;
    margin-top:12px;
    border-radius:12px;
    border:none;
    font-size:15px;
}

/* INFO BOX */
.info{
    margin-top:16px;
    padding:14px;
    border-radius:14px;
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.15);
}

/* BUTTON */
.main-btn{
    width:100%;
    margin-top:18px;
    padding:16px;
    background:#F2B840;
    color:#06142E;
    font-weight:bold;
    font-size:16px;
    border:none;
    border-radius:14px;
    cursor:pointer;
    display:none;
}

/* SCROLL TOP */
#topBtn{
    position:fixed;
    bottom:20px;
    right:20px;
    width:46px;
    height:46px;
    border-radius:50%;
    background:#F2B840;
    color:#06142E;
    display:none;
    align-items:center;
    justify-content:center;
    font-size:22px;
    cursor:pointer;
}
</style>
</head>

<body>

<header>
    <button onclick="history.back()">←</button>
    <h1>CizaRide+ — Client</h1>
    <button onclick="location.reload()">⟳</button>
</header>

<div id="map"></div>

<div class="panel">
    <h2>Votre trajet</h2>

    <input id="start" placeholder="Lieu de départ">
    <input id="end" placeholder="Destination">

    <div class="info" id="result">
        Distance : — <br>
        Prix estimé : —
    </div>

    <button class="main-btn" id="orderBtn">Commander la course</button>
</div>

<div id="topBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

<script>
let map = L.map('map').setView([46.8139, -71.2080], 13); // Québec par défaut
let routeControl;
let pricePerKm = 1500; // BIF (modifiable)

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'© OpenStreetMap'
}).addTo(map);

// GEOLOCALISATION CLIENT
if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
        let lat = pos.coords.latitude;
        let lng = pos.coords.longitude;
        map.setView([lat,lng],14);
        L.marker([lat,lng]).addTo(map).bindPopup("Votre position").openPopup();
    });
}

function calculateRoute(){
    let start = document.getElementById("start").value;
    let end   = document.getElementById("end").value;
    if(!start || !end) return;

    if(routeControl) map.removeControl(routeControl);

    routeControl = L.Routing.control({
        waypoints: [
            L.Routing.waypoint(null, start),
            L.Routing.waypoint(null, end)
        ],
        show:false,
        addWaypoints:false
    }).addTo(map);

    routeControl.on('routesfound', function(e){
        let km = e.routes[0].summary.totalDistance / 1000;
        let price = Math.round(km * pricePerKm);

        document.getElementById("result").innerHTML =
            "Distance : <b>"+km.toFixed(1)+" km</b><br>" +
            "Prix estimé : <b>"+price.toLocaleString()+" BIF</b>";

        document.getElementById("orderBtn").style.display = "block";
    });
}

document.getElementById("start").addEventListener("change", calculateRoute);
document.getElementById("end").addEventListener("change", calculateRoute);

// COMMANDER
document.getElementById("orderBtn").onclick = ()=>{
    alert(
        "Course confirmée ✅\n\n" +
        "Départ : " + document.getElementById("start").value + "\n" +
        "Destination : " + document.getElementById("end").value + "\n\n" +
        "Étape suivante : Paiement"
    );
};

// SCROLL BTN
window.addEventListener("scroll",()=>{
    document.getElementById("topBtn").style.display =
        window.scrollY>300 ? "flex" : "none";
});
</script>

</body>
</html>
