<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CizaRide+ — Carte Premium</title>
<link rel="icon" href="logotransparent.png">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
    body{
        margin:0;
        background:#06142E;
        font-family:Arial, sans-serif;
        color:white;
    }

    /* HEADER */
    header{
        display:flex;
        justify-content:space-between;
        align-items:center;
        background:rgba(255,255,255,0.06);
        padding:15px 18px;
        border-bottom:2px solid #F2B840;
        backdrop-filter:blur(10px);
        position:sticky;
        top:0;
        z-index:999;
    }
    header img{
        width:48px;
    }
    header button{
        background:#F2B840;
        border:none;
        padding:8px 14px;
        border-radius:10px;
        font-weight:bold;
        cursor:pointer;
        color:#06142E;
    }

    /* MAP */
    #map{
        height:60vh;
        width:100%;
        margin-top:10px;
        border-radius:14px;
        border:3px solid #F2B840;
        overflow:hidden;
        box-shadow:0 0 25px rgba(242,184,64,0.35);
        position:relative;
    }

    /* SIGNATURE DISCRÈTE */
    .signature{
        position:absolute;
        bottom:6px;
        left:10px;
        font-size:11px;
        opacity:0.45;
        background:rgba(0,0,0,0.35);
        padding:3px 6px;
        border-radius:6px;
    }

    /* BOX FORMULAIRE */
    .box{
        background:rgba(255,255,255,0.05);
        width:90%;
        margin:20px auto;
        padding:18px;
        border-radius:16px;
        border:1px solid rgba(242,184,64,0.4);
        backdrop-filter:blur(10px);
    }
    input{
        width:100%;
        padding:12px;
        margin-top:12px;
        background:#0B1C35;
        border:none;
        color:white;
        border-radius:10px;
    }
    .btn{
        margin-top:15px;
        width:100%;
        padding:12px;
        background:#F2B840;
        border:none;
        border-radius:10px;
        color:#06142E;
        cursor:pointer;
        font-weight:bold;
    }
    .result{
        margin-top:15px;
        padding:10px;
        background:rgba(255,255,255,0.12);
        border-left:3px solid #F2B840;
        border-radius:10px;
    }

    /* MULTILINGUE */
    .lang-btn{
        position:fixed;
        bottom:20px;
        right:20px;
        padding:12px 15px;
        border-radius:50px;
        background:#F2B840;
        color:#06142E;
        font-weight:bold;
        border:none;
        cursor:pointer;
        z-index:999;
    }
</style>
</head>

<body>

<header>
    <img src="logotransparent.png">
    <button onclick="history.back()">← Retour</button>
</header>

<div id="map">
    <div class="signature">CIZA GROUP — Navigation Premium</div>
</div>

<div class="box">
    <input id="depart" placeholder="Point de départ">
    <input id="arrivee" placeholder="Destination">

    <button class="btn" onclick="calculerDistance()">Calculer la distance</button>

    <div id="result" class="result" style="display:none;"></div>

    <button class="btn" style="background:#34ff99;" onclick="payer()">Continuer vers Paiement</button>
</div>

<button class="lang-btn" onclick="switchLang()">FR</button>

<script>
// ---- MAP TILER PREMIUM DARK ----
var map = L.map('map').setView([-3.38, 29.38], 13);

L.tileLayer(
    "https://api.maptiler.com/maps/streets-v2-dark/256/{z}/{x}/{y}.png?key=YOUR_KEY_HERE",
    {
        attribution: "© CIZA GROUP | © MapTiler © OpenStreetMap",
    }
).addTo(map);

// ---- MARKERS ----
let markerA, markerB, route;

// ---- GEOCODING ----
async function geocode(txt){
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(txt)}`;
    const r = await fetch(url);
    const data = await r.json();
    return data.length ? [parseFloat(data[0].lat), parseFloat(data[0].lon)] : null;
}

// ---- DISTANCE ----
async function calculerDistance(){
    const d = document.getElementById("depart").value;
    const a = document.getElementById("arrivee").value;

    if(!d || !a){ alert("Remplissez les champs."); return; }

    const P1 = await geocode(d);
    const P2 = await geocode(a);

    if(!P1 || !P2){ alert("Lieu introuvable."); return; }

    if(markerA) markerA.remove();
    if(markerB) markerB.remove();
    if(route) route.remove();

    markerA = L.marker(P1).addTo(map);
    markerB = L.marker(P2).addTo(map);

    route = L.polyline([P1, P2], {
        color:"#F2B840",
        weight:5,
        opacity:0.8
    }).addTo(map);

    map.fitBounds(route.getBounds(), { padding:[40,40] });

    const R = 6371;
    const dLat = (P2[0]-P1[0])*Math.PI/180;
    const dLon = (P2[1]-P1[1])*Math.PI/180;
    const a2 = Math.sin(dLat/2)**2 + Math.cos(P1[0]*Math.PI/180)*Math.cos(P2[0]*Math.PI/180)*Math.sin(dLon/2)**2;
    const c = 2*Math.atan2(Math.sqrt(a2), Math.sqrt(1-a2));
    const dist = R*c;

    document.getElementById("result").style.display="block";
    document.getElementById("result").innerHTML =
        `<b>Distance :</b> ${dist.toFixed(2)} km<br>
         <b>Durée estimée :</b> ${(dist/35*60).toFixed(0)} min`;
}

function payer(){
    alert("Paiement : Lumicash • Ecocash • Visa • Mastercard (clé API en attente)");
}

// MULTILINGUE
function switchLang(){
    const html=document.documentElement;
    html.lang = html.lang==="fr" ? "en" : "fr";
    document.querySelector(".lang-btn").innerHTML = html.lang==="fr" ? "FR" : "EN";
}
</script>

</body>
</html>
