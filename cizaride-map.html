<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CizaRide+ — Commander une course</title>
<link rel="icon" href="logotransparent.png">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet Routing -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#06142E;
    color:white;
}

/* HEADER */
header{
    position:fixed;
    top:0;
    width:100%;
    background:#06142E;
    padding:12px;
    display:flex;
    align-items:center;
    gap:12px;
    z-index:1000;
}
header img{ width:42px; }
header h1{
    font-size:18px;
    color:#F2B840;
    margin:0;
}

/* MAP */
#map{
    height:100vh;
    margin-top:64px;
}

/* PANEL */
.panel{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    width:92%;
    max-width:420px;
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(14px);
    border:1px solid rgba(255,255,255,0.15);
    border-radius:20px;
    padding:18px;
    box-shadow:0 0 25px rgba(0,0,0,0.45);
}

/* INPUTS */
input{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:none;
    margin-bottom:10px;
    background:#0B1C34;
    color:white;
}

/* BUTTONS */
button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:14px;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
}

.btn-calc{
    background:#F2B840;
    color:#06142E;
}

.btn-pay{
    background:#22c55e;
    color:#06142E;
    display:none;
    margin-top:10px;
}

/* RESULT */
.result{
    margin-top:10px;
    font-size:15px;
    opacity:.9;
}

/* FLOAT BUTTONS */
#backBtn, #topBtn{
    position:fixed;
    width:44px;
    height:44px;
    border-radius:50%;
    background:#F2B840;
    color:#06142E;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
    cursor:pointer;
    z-index:999;
}
#backBtn{ top:80px; left:15px; }
#topBtn{ bottom:20px; right:15px; display:none; }

footer{
    text-align:center;
    font-size:12px;
    opacity:.6;
    margin:15px 0;
}
</style>
</head>

<body>

<header>
    <img src="logotransparent.png">
    <h1>CizaRide+ — Commander une course</h1>
</header>

<div id="map"></div>

<div id="backBtn" onclick="history.back()">←</div>
<div id="topBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</div>

<div class="panel">
    <input id="start" placeholder="Lieu de départ">
    <input id="end" placeholder="Destination">

    <button class="btn-calc" id="calcBtn">Calculer le prix</button>

    <div class="result" id="result"></div>

    <button class="btn-pay" id="payBtn">Payer & Commander</button>

    <footer>Design signed by <b>CIZA GROUP</b></footer>
</div>

<script>
let map = L.map('map').setView([45.5019, -73.5674], 13); // Québec par défaut

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'© OpenStreetMap'
}).addTo(map);

// Géolocalisation client
if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
        map.setView([pos.coords.latitude, pos.coords.longitude], 14);
    });
}

let routeControl;

// Calcul bouton
document.getElementById("calcBtn").onclick = ()=>{
    let start = document.getElementById("start").value;
    let end   = document.getElementById("end").value;

    if(!start || !end){
        alert("Veuillez entrer le départ et la destination");
        return;
    }

    document.getElementById("result").innerHTML="⏳ Calcul en cours...";
    document.getElementById("payBtn").style.display="none";

    if(routeControl){ map.removeControl(routeControl); }

    routeControl = L.Routing.control({
        waypoints:[
            L.Routing.waypoint(null, start),
            L.Routing.waypoint(null, end)
        ],
        routeWhileDragging:false,
        show:false,
        addWaypoints:false
    }).addTo(map);

    routeControl.on('routesfound', e=>{
        let km = e.routes[0].summary.totalDistance / 1000;

        // TARIFICATION RÉELLE
        let base = 3000;      // départ
        let perKm = 1800;     // par km
        let price = Math.round(base + km * perKm);

        document.getElementById("result").innerHTML =
            `Distance : <b>${km.toFixed(2)} km</b><br>
             Prix : <b>${price.toLocaleString()} BIF</b>`;

        document.getElementById("payBtn").style.display="block";
    });
};

// Scroll top
window.addEventListener("scroll",()=>{
    document.getElementById("topBtn").style.display =
        window.scrollY>300 ? "flex":"none";
});

// Paiement (placeholder réel)
document.getElementById("payBtn").onclick=()=>{
    alert("Paiement Mobile Money — étape suivante (Firebase)");
};
</script>

</body>
</html>
