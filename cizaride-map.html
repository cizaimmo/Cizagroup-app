<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CizaRide+ — Navigation</title>
<link rel="icon" href="logotransparent.png">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
    body{
        margin:0;
        background:#06142E;
        font-family:Arial, sans-serif;
        color:white;
        overflow-x:hidden;
    }

    /* HEADER */
    header{
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:15px;
        background:#071A36;
        border-bottom:3px solid #F2B840;
    }
    header img{ width:55px; }

    .back-btn{
        background:#F2B840;
        padding:10px 18px;
        border-radius:12px;
        color:#06142E;
        font-weight:bold;
        text-decoration:none;
    }

    /* MAP */
    #map{
        width:96%;
        height:55vh;
        margin:15px auto;
        border-radius:18px;
        border:3px solid #F2B840;
        overflow:hidden;
    }

    .box{
        width:90%;
        margin:10px auto 30px;
        background:rgba(255,255,255,0.06);
        padding:20px;
        border-radius:16px;
        border:1px solid rgba(242,184,64,0.4);
    }

    input{
        width:100%;
        padding:13px;
        border-radius:10px;
        border:none;
        margin-bottom:10px;
        background:#0B1C35;
        color:white;
        font-size:17px;
    }

    .btn{
        background:#F2B840;
        border:none;
        width:100%;
        padding:14px;
        font-size:18px;
        border-radius:12px;
        color:#06142E;
        font-weight:bold;
        margin-top:10px;
    }

    .result{
        margin-top:15px;
        padding:15px;
        background:rgba(255,255,255,0.1);
        border-left:4px solid #F2B840;
        border-radius:10px;
        display:none;
    }

    .lang{
        position:fixed;
        bottom:20px;
        right:20px;
        background:#F2B840;
        color:#06142E;
        padding:12px 15px;
        border-radius:50px;
        font-weight:bold;
        cursor:pointer;
    }
</style>
</head>

<body>

<header>
    <img src="logotransparent.png">
    <a href="ride.html" class="back-btn">← Retour</a>
</header>

<div id="map"></div>

<div class="box">

    <input id="nom" type="text" placeholder="Nom complet">

    <input id="tel" type="text" placeholder="Téléphone">

    <input id="depart" type="text" placeholder="Point de départ">
    <input id="arrivee" type="text" placeholder="Destination">

    <button class="btn" onclick="calcul()">Calculer la distance</button>

    <div id="res" class="result"></div>

    <button class="btn" style="background:#2cff9c;" onclick="payer()">Continuer vers paiement</button>

</div>

<div class="lang" onclick="toggleLang()">FR</div>


<script>

// ====== MAP CLAIRE (AUCUNE CLE NÉCESSAIRE) ======
var map = L.map('map').setView([-3.38, 29.38], 13);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom:19,
    attribution:"© OpenStreetMap • CIZA GROUP"
}).addTo(map);

// Markers & route storage
let m1, m2, route;

// Geocode OSM
async function geo(q){
    let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`;
    let r = await fetch(url);
    let data = await r.json();
    return data.length ? [data[0].lat, data[0].lon] : null;
}

// Distance calculation
async function calcul(){
    let d = document.getElementById("depart").value;
    let a = document.getElementById("arrivee").value;

    if(!d || !a){ alert("Veuillez entrer départ et destination."); return;}

    let p1 = await geo(d); 
    let p2 = await geo(a);

    if(!p1 || !p2){ alert("Lieu introuvable"); return;}

    if(m1) m1.remove();
    if(m2) m2.remove();
    if(route) route.remove();

    m1 = L.marker(p1).addTo(map);
    m2 = L.marker(p2).addTo(map);

    route = L.polyline([p1, p2], {color:"#F2B840", weight:5}).addTo(map);
    map.fitBounds(route.getBounds(), {padding:[30,30]});

    let R = 6371;
    let lat1 = p1[0]*Math.PI/180, lat2 = p2[0]*Math.PI/180;
    let dLat = lat2-lat1;
    let dLon = (p2[1]-p1[1]) * Math.PI/180;

    let x = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
    let km = R * 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1-x));

    document.getElementById("res").style.display = "block";
    document.getElementById("res").innerHTML =
        `<b>Distance :</b> ${km.toFixed(2)} km<br>
         <b>Durée estimée :</b> ${(km/35*60).toFixed(0)} minutes`;
}

function payer(){
    alert("Paiement : Lumicash, Ecocash, Inoti, Visa, Mastercard");
}

// Language toggle placeholder
function toggleLang(){
    alert("Changement de langue bientôt actif.");
}

</script>

</body>
</html>
