<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaRide+ ‚Äî Commander une course</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#06142E;
  color:white;
}

header{
  padding:14px;
  background:#0B1C34;
  text-align:center;
  font-size:20px;
  font-weight:bold;
  color:#F2B840;
}

#map{
  height:45vh;
}

.panel{
  padding:16px;
}

label{
  display:block;
  margin-top:12px;
  font-size:14px;
  opacity:.9;
}

select, button{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:10px;
  border:none;
  font-size:15px;
}

select{
  background:#0B1C34;
  color:white;
}

button{
  background:#F2B840;
  color:#06142E;
  font-weight:bold;
  cursor:pointer;
}

button.secondary{
  background:#1A2E55;
  color:white;
}

#priceBox{
  margin-top:14px;
  padding:14px;
  background:#0B1C34;
  border-radius:12px;
  display:none;
}

.footer-btns{
  display:flex;
  gap:10px;
  margin-top:14px;
}
</style>
</head>

<body>

<header>
  üöó CizaRide+ ‚Äî Commander une course
</header>

<div id="map"></div>

<div class="panel">

  <label>üìç D√©part (position actuelle)</label>
  <div style="opacity:.8;font-size:14px;">Localisation automatique activ√©e</div>

  <label>üèÅ Destination (quartier)</label>
  <select id="destination">
    <option value="">‚Äî Choisir un quartier ‚Äî</option>
    <option>Kamenge, Bujumbura</option>
    <option>Ngagara, Bujumbura</option>
    <option>Kinama, Bujumbura</option>
    <option>Musaga, Bujumbura</option>
    <option>Kanyosha, Bujumbura</option>
    <option>Cibitoke, Bujumbura</option>
    <option>Buyenzi, Bujumbura</option>
    <option>Rohero, Bujumbura</option>
  </select>

  <button onclick="calculateRide()">Calculer le prix</button>

  <div id="priceBox">
    <div id="distanceText"></div>
    <div id="priceText" style="margin-top:6px;font-weight:bold;"></div>

    <button style="margin-top:10px;">Payer maintenant</button>
  </div>

  <div class="footer-btns">
    <button class="secondary" onclick="location.reload()">üîÑ Rafra√Æchir</button>
    <button class="secondary" onclick="history.back()">‚¨Ö Retour</button>
  </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map, userMarker, userLatLng;

map = L.map('map').setView([-3.3614, 29.3599], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

// GPS automatique
navigator.geolocation.getCurrentPosition(pos=>{
  userLatLng = [pos.coords.latitude, pos.coords.longitude];
  map.setView(userLatLng, 15);

  userMarker = L.marker(userLatLng).addTo(map)
    .bindPopup("üìç Vous √™tes ici")
    .openPopup();
},()=>{
  alert("Localisation refus√©e");
});

// Calcul distance + prix
async function calculateRide(){
  const dest = document.getElementById("destination").value;
  if(!dest){ alert("Choisissez une destination"); return; }

  const geo = await fetch(
    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(dest + ", Burundi")}`
  );
  const data = await geo.json();
  if(!data[0]){ alert("Destination introuvable"); return; }

  const destLatLng = [data[0].lat, data[0].lon];

  L.marker(destLatLng).addTo(map).bindPopup("üèÅ Destination");

  const distKm = map.distance(userLatLng, destLatLng) / 1000;

  // üí∞ Tarification PRO (modifiable plus tard)
  const base = 4000;        // BIF
  const perKm = 1200;       // BIF
  const price = Math.round(base + distKm * perKm);

  document.getElementById("priceBox").style.display="block";
  document.getElementById("distanceText").innerText =
    `Distance estim√©e : ${distKm.toFixed(1)} km`;
  document.getElementById("priceText").innerText =
    `Prix : ${price.toLocaleString()} BIF`;
}
</script>

</body>
</html>
