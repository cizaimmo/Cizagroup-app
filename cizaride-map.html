<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CizaRide+ â€” Carte Client</title>
<link rel="icon" href="logotransparent.png">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}

html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:Arial,sans-serif;
  background:#06142E;
}

/* HEADER */
header{
  position:absolute;
  top:0; left:0; right:0;
  z-index:1000;
  background:rgba(6,20,46,.96);
  color:#F2B840;
  padding:14px 18px;
  display:flex;
  align-items:center;
  gap:12px;
  border-bottom:1px solid #F2B840;
}
header img{width:42px;}
header span{font-weight:bold;font-size:18px;}

/* MAP */
#map{
  position:absolute;
  inset:0;
}

/* PANEL (ne bloque PAS la carte) */
#panel{
  position:absolute;
  bottom:14px;
  left:50%;
  transform:translateX(-50%);
  width:94%;
  background:rgba(6,20,46,.95);
  color:white;
  padding:16px;
  border-radius:22px;
  z-index:1000;
  box-shadow:0 0 25px rgba(0,0,0,.45);

  pointer-events:none; /* ğŸ”‘ la carte reste cliquable */
}

.line{
  font-size:14px;
  margin-bottom:6px;
  opacity:.9;
}

.price{
  font-size:22px;
  color:#F2B840;
  font-weight:bold;
  margin:8px 0;
}

/* Bouton cliquable */
#panel button{
  pointer-events:auto;
  width:100%;
  border:none;
  padding:16px;
  font-size:18px;
  border-radius:30px;
  background:#F2B840;
  color:#06142E;
  font-weight:bold;
  cursor:pointer;
}
#panel button:disabled{
  background:#888;
  cursor:not-allowed;
}
</style>
</head>

<body>

<header>
  <img src="logotransparent.png">
  <span>Client â€” Commander un trajet</span>
</header>

<div id="map"></div>

<div id="panel">
  <div class="line">ğŸ“ DÃ©part : position actuelle</div>
  <div class="line" id="dest">ğŸ“ Destination : touchez la carte</div>
  <div class="line" id="distance">ğŸ“ Distance : â€”</div>
  <div class="line" id="time">â± DurÃ©e estimÃ©e : â€”</div>
  <div class="price" id="price">ğŸ’° Prix : â€”</div>
  <button id="order" disabled>ğŸš— Commander la course</button>
</div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map, startMarker, endMarker, routeLine;
let startPos=null, endPos=null;

/* INIT MAP */
map = L.map('map').setView([-3.3614,29.3599],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

/* GEOLOCATION */
navigator.geolocation.getCurrentPosition(pos=>{
  startPos=[pos.coords.latitude,pos.coords.longitude];
  map.setView(startPos,15);
  startMarker=L.marker(startPos).addTo(map)
    .bindPopup("ğŸ“ Votre position").openPopup();
},()=>{
  alert("âš ï¸ Activez la gÃ©olocalisation");
});

/* DESTINATION (clic carte) */
map.on('click',e=>{
  endPos=[e.latlng.lat,e.latlng.lng];

  if(endMarker) map.removeLayer(endMarker);
  endMarker=L.marker(endPos).addTo(map)
    .bindPopup("ğŸ“ Destination sÃ©lectionnÃ©e")
    .openPopup();

  document.getElementById("dest").textContent =
    "ğŸ“ Destination : sÃ©lectionnÃ©e";

  calculateRoute();
});

/* ROUTE + CALCUL */
function calculateRoute(){
  if(!startPos || !endPos) return;

  const url=`https://router.project-osrm.org/route/v1/driving/
    ${startPos[1]},${startPos[0]};
    ${endPos[1]},${endPos[0]}
    ?overview=full&geometries=geojson`;

  fetch(url)
    .then(r=>r.json())
    .then(data=>{
      const r=data.routes[0];
      const km=(r.distance/1000).toFixed(2);
      const min=Math.ceil(r.duration/60);

      document.getElementById("distance").textContent =
        `ğŸ“ Distance : ${km} km`;
      document.getElementById("time").textContent =
        `â± DurÃ©e estimÃ©e : ${min} min`;

      /* TARIF BURUNDI (modifiable) */
      const base=2000;   // BIF
      const perKm=1000;  // BIF/km
      const price=Math.round(base + km*perKm);

      document.getElementById("price").textContent =
        `ğŸ’° Prix : ${price.toLocaleString()} BIF`;

      document.getElementById("order").disabled=false;

      if(routeLine) map.removeLayer(routeLine);
      routeLine=L.geoJSON(r.geometry,{
        style:{color:'#F2B840',weight:5}
      }).addTo(map);
    });
}

/* COMMANDER */
document.getElementById("order").onclick=()=>{
  alert("ğŸš• Course envoyÃ©e aux chauffeurs disponibles");
};
</script>

</body>
</html>
