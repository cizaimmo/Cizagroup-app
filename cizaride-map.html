<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CizaRide+ â€” Carte Client</title>
<link rel="icon" href="logotransparent.png">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:Arial,sans-serif;
  background:#06142E;
}

/* HEADER */
header{
  position:absolute;
  top:0;left:0;right:0;
  z-index:1000;
  background:rgba(6,20,46,.96);
  color:#F2B840;
  padding:14px 18px;
  display:flex;
  align-items:center;
  gap:12px;
  border-bottom:1px solid #F2B840;
}
header img{width:42px;}
header span{font-weight:bold;font-size:18px;}

/* MAP */
#map{
  position:absolute;
  inset:0;
  touch-action:pan-x pan-y;
}

/* PANEL */
#panel{
  position:absolute;
  bottom:14px;
  left:50%;
  transform:translateX(-50%);
  width:94%;
  background:rgba(6,20,46,.95);
  color:white;
  padding:16px;
  border-radius:22px;
  z-index:1000;
  box-shadow:0 0 25px rgba(0,0,0,.45);
}

.row{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 6px;
  border-bottom:1px solid rgba(255,255,255,.08);
  cursor:pointer;
}
.row:last-child{border-bottom:none}
.row span{opacity:.9}
.row small{opacity:.6}

.price{
  font-size:22px;
  color:#F2B840;
  font-weight:bold;
  margin:12px 0;
  text-align:center;
}

button{
  width:100%;
  border:none;
  padding:16px;
  font-size:18px;
  border-radius:30px;
  background:#F2B840;
  color:#06142E;
  font-weight:bold;
  cursor:pointer;
}
button:disabled{
  background:#777;
  cursor:not-allowed;
}
</style>
</head>

<body>

<header>
  <img src="logotransparent.png">
  <span>Client â€” Commander un trajet</span>
</header>

<div id="map"></div>

<div id="panel">
  <div class="row" id="startRow">
    ğŸ“ <span id="startTxt">DÃ©part : position actuelle</span>
  </div>

  <div class="row" id="destRow">
    ğŸ¯ <span id="destTxt">Destination : touchez la carte</span>
  </div>

  <div class="row">
    ğŸ“ <span id="distance">Distance : â€”</span>
  </div>

  <div class="row">
    â± <span id="time">DurÃ©e estimÃ©e : â€”</span>
  </div>

  <div class="price" id="price">ğŸ’° Prix : â€”</div>

  <button id="order" disabled>ğŸš— Commander la course</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map, startPos=null, endPos=null;
let startMarker, endMarker, routeLine;

/* MAP */
map=L.map('map',{dragging:true}).setView([-3.3614,29.3599],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

/* DÃ‰PART : position rÃ©elle */
function setStart(){
  navigator.geolocation.getCurrentPosition(pos=>{
    startPos=[pos.coords.latitude,pos.coords.longitude];
    if(startMarker) map.removeLayer(startMarker);
    startMarker=L.marker(startPos).addTo(map)
      .bindPopup("ğŸ“ DÃ©part").openPopup();
    map.setView(startPos,15);
    document.getElementById("startTxt").textContent="DÃ©part : position actuelle";
    calculate();
  });
}
setStart();

/* DESTINATION : clic carte */
map.on('click',e=>{
  endPos=[e.latlng.lat,e.latlng.lng];
  if(endMarker) map.removeLayer(endMarker);
  endMarker=L.marker(endPos).addTo(map)
    .bindPopup("ğŸ¯ Destination").openPopup();
  document.getElementById("destTxt").textContent="Destination : sÃ©lectionnÃ©e";
  calculate();
});

/* CALCUL RÃ‰EL */
function calculate(){
  if(!startPos || !endPos) return;

  const url=
    "https://router.project-osrm.org/route/v1/driving/"
    + startPos[1]+","+startPos[0]+";"
    + endPos[1]+","+endPos[0]
    + "?overview=full&geometries=geojson";

  fetch(url).then(r=>r.json()).then(d=>{
    const r=d.routes[0];
    const km=(r.distance/1000).toFixed(2);
    const min=Math.ceil(r.duration/60);

    document.getElementById("distance").textContent="Distance : "+km+" km";
    document.getElementById("time").textContent="DurÃ©e estimÃ©e : "+min+" min";

    const price=Math.round(2000 + km*1000);
    document.getElementById("price").textContent="ğŸ’° Prix : "+price.toLocaleString()+" BIF";
    document.getElementById("order").disabled=false;

    if(routeLine) map.removeLayer(routeLine);
    routeLine=L.geoJSON(r.geometry,{style:{color:"#F2B840",weight:5}}).addTo(map);
  });
}

/* ACTIONS */
document.getElementById("startRow").onclick=setStart;
document.getElementById("order").onclick=()=>{
  alert("ğŸš• Course envoyÃ©e aux chauffeurs disponibles");
};
</script>

</body>
</html>
