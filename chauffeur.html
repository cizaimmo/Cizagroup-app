<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaRide+ Driver</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui, Arial;
  background:#06142E;
  color:white;
}

header{
  position:sticky;
  top:0;
  background:#0B1D3A;
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:2px solid #F2B840;
}

/* üîô BOUTON RETOUR */
.back-btn{
  position:absolute;
  left:14px;
  top:50%;
  transform:translateY(-50%);
  width:40px;
  height:40px;
  border-radius:50%;
  background:#06142E;
  border:2px solid #F2B840;
  color:#F2B840;
  font-size:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 0 12px rgba(242,184,64,.35);
}
.back-btn:active{
  transform:translateY(-50%) scale(.95);
}

.header-title{
  margin-left:56px;
  font-weight:bold;
}

.status{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:14px;
}
.dot{
  width:10px;
  height:10px;
  border-radius:50%;
  background:red;
}
.online .dot{background:#00ff88}

.container{
  padding:16px;
}

.card{
  background:#0B1D3A;
  border:2px solid #F2B840;
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
  box-shadow:0 0 15px rgba(242,184,64,.25);
}

.card h3{
  margin:0 0 6px;
  color:#F2B840;
}

.card p{
  margin:4px 0;
  font-size:14px;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:10px;
}

button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:18px;
  font-size:15px;
  font-weight:800;
  cursor:pointer;
}

.accept{background:#00ff88;color:#06142E}
.refuse{background:#ff5555;color:white}

.signature{
  text-align:center;
  font-size:11px;
  opacity:.6;
  margin:18px 0;
}
.signature b{color:#F2B840}
</style>
</head>

<body>

<header>
  <!-- üîô RETOUR PORTAIL -->
  <div class="back-btn" onclick="goBack()">‚Üê</div>

  <div class="header-title">üöï CizaRide+ Driver</div>

  <div class="status" id="statusBox">
    <div class="dot"></div>
    <span id="statusText">Hors ligne</span>
  </div>
</header>

<div class="container" id="rides">
  <p style="opacity:.6;text-align:center">
    Aucune course pour l‚Äôinstant
  </p>
</div>

<div class="signature">
  Design signed by <b>CIZA GROUP</b>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* üî• CONFIG FIREBASE ‚Äî UTILISE LA M√äME QUE LE CLIENT */
const firebaseConfig = {
  apiKey: "REMPLACE_ICI",
  authDomain: "REMPLACE_ICI.firebaseapp.com",
  projectId: "REMPLACE_ICI",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>
/* üîô RETOUR PORTAIL */
function goBack(){
  window.location.href = "portail.html";
}

/* ===============================
   MODE EN LIGNE / HORS LIGNE
================================ */
let online = false;
const statusBox = document.getElementById("statusBox");
const statusText = document.getElementById("statusText");

statusBox.onclick = ()=>{
  online = !online;
  statusBox.classList.toggle("online", online);
  statusText.textContent = online ? "En ligne" : "Hors ligne";
};

/* ===============================
   √âCOUTE DES COURSES (TEMPS R√âEL)
================================ */
const ridesBox = document.getElementById("rides");

db.collection("rides")
  .where("status","==","waiting")
  .onSnapshot(snapshot=>{
    ridesBox.innerHTML = "";

    if(snapshot.empty){
      ridesBox.innerHTML =
        "<p style='opacity:.6;text-align:center'>Aucune course disponible</p>";
      return;
    }

    snapshot.forEach(doc=>{
      const r = doc.data();
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <h3>üìç Nouvelle course</h3>
        <p><b>D√©part :</b> ${r.from}</p>
        <p><b>Destination :</b> ${r.to}</p>
        <p><b>Distance :</b> ${r.km} km</p>
        <p><b>Prix :</b> ${r.price.toLocaleString()} BIF</p>

        <div class="actions">
          <button class="accept">Accepter</button>
          <button class="refuse">Refuser</button>
        </div>
      `;

      card.querySelector(".accept").onclick = ()=>{
        db.collection("rides").doc(doc.id).update({
          status:"accepted",
          driverId:"driver_demo"
        });
      };

      card.querySelector(".refuse").onclick = ()=>{
        db.collection("rides").doc(doc.id).update({
          status:"refused"
        });
      };

      ridesBox.appendChild(card);
    });
  });
</script>

</body>
</html>
