<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaRide+ Driver â€” Tableau de bord</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:system-ui,Arial;background:#06142E;color:white}
#map{height:100%}

/* Header */
header{
  position:fixed;top:0;left:0;width:100%;
  padding:14px;background:#0B1D3A;z-index:1000;
  display:flex;justify-content:space-between;align-items:center
}
.status{display:flex;align-items:center;gap:8px}
.dot{width:12px;height:12px;border-radius:50%;background:red}
.online{background:#00ff88}

/* Card */
#rideCard{
  position:fixed;bottom:12px;left:50%;transform:translateX(-50%);
  width:94%;background:#0B1D3A;border-radius:22px;
  padding:16px;z-index:1000;display:none;
  box-shadow:0 12px 30px rgba(0,0,0,.45)
}
.row{margin:6px 0;font-size:15px}
.price{color:#F2B840;font-size:20px;font-weight:800}
.actions{display:flex;gap:10px;margin-top:12px}
.actions button{
  flex:1;padding:14px;border:none;border-radius:25px;
  font-size:15px;font-weight:800
}
.accept{background:#00c853;color:#06142E}
.refuse{background:#c62828;color:white}
.signature{text-align:center;font-size:11px;opacity:.6;margin-top:10px}
.signature b{color:#F2B840}
</style>
</head>

<body>
<header>
  <div><b>CizaRide+</b> Driver</div>
  <div class="status">
    <div class="dot" id="statusDot"></div>
    <span id="statusText">Hors ligne</span>
    <button onclick="toggleStatus()">ğŸ”„</button>
  </div>
</header>

<div id="map"></div>

<div id="rideCard">
  <div class="row">ğŸ“ DÃ©part : <span id="start"></span></div>
  <div class="row">ğŸ¯ Destination : <span id="dest"></span></div>
  <div class="row">ğŸ“ Distance : <span id="distance"></span></div>
  <div class="price">ğŸ’° <span id="price"></span> BIF</div>
  <div class="actions">
    <button class="accept" onclick="acceptRide()">âœ… Accepter</button>
    <button class="refuse" onclick="refuseRide()">âŒ Refuser</button>
  </div>
  <div class="signature">Design signed by <b>CIZA GROUP</b></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* MAP */
const map=L.map('map').setView([-3.3614,29.3599],12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap'}).addTo(map);

let online=false, routeLine=null, startMarker=null, endMarker=null;

function toggleStatus(){
  online=!online;
  document.getElementById("statusDot").classList.toggle("online",online);
  document.getElementById("statusText").textContent=online?"En ligne":"Hors ligne";
  if(online) simulateRide(); else resetRide();
}
function resetRide(){
  document.getElementById("rideCard").style.display="none";
  if(routeLine) map.removeLayer(routeLine);
  if(startMarker) map.removeLayer(startMarker);
  if(endMarker) map.removeLayer(endMarker);
}

/* Geocode + Route */
function geocode(place){
  return fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place+", Bujumbura")}`)
    .then(r=>r.json()).then(d=>{
      if(!d.length) throw "Lieu introuvable";
      return [parseFloat(d[0].lat),parseFloat(d[0].lon)];
    });
}
async function simulateRide(){
  setTimeout(async ()=>{
    if(!online) return;
    const startName="Kanyosha", destName="Rohero";
    document.getElementById("start").textContent=startName;
    document.getElementById("dest").textContent=destName;
    document.getElementById("distance").textContent="â€”";
    document.getElementById("price").textContent="â€”";
    document.getElementById("rideCard").style.display="block";
    try{
      const s=await geocode(startName), e=await geocode(destName);
      startMarker=L.marker(s).addTo(map);
      endMarker=L.marker(e).addTo(map);
      const url=`https://router.project-osrm.org/route/v1/driving/${s[1]},${s[0]};${e[1]},${e[0]}?overview=full&geometries=geojson`;
      const res=await fetch(url).then(r=>r.json());
      const r0=res.routes[0];
      routeLine=L.geoJSON(r0.geometry,{style:{color:"#00ff88",weight:5}}).addTo(map);
      map.fitBounds(routeLine.getBounds(),{padding:[40,40]});
      const km=(r0.distance/1000).toFixed(1);
      document.getElementById("distance").textContent=km+" km";
      document.getElementById("price").textContent=(2000+km*1000).toLocaleString();
    }catch(e){ alert("Erreur de tracÃ©"); }
  },1200);
}
function acceptRide(){ alert("ğŸš• Course acceptÃ©e"); }
function refuseRide(){ alert("âŒ Course refusÃ©e"); resetRide(); }
</script>
</body>
</html>
