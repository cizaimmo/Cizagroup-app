<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CizaRide+ â€” Commander</title>
<link rel="icon" href="logotransparent.png" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:system-ui,Arial;background:#06142E}
#map{height:100%}

/* Bottom sheet (Uber-like) */
#sheet{
  position:fixed;left:50%;bottom:12px;transform:translateX(-50%);
  width:94%;background:#0B1D3A;color:#fff;border-radius:20px;
  padding:14px;z-index:1000;box-shadow:0 10px 30px rgba(0,0,0,.4)
}
.field{
  background:#122A52;border-radius:12px;padding:12px;margin-bottom:8px;
  display:flex;gap:10px;align-items:center
}
.field input{
  width:100%;border:none;background:transparent;color:#fff;
  font-size:15px;outline:none
}
.results{max-height:180px;overflow:auto;margin:6px 0}
.result{
  background:#122A52;border-radius:10px;padding:10px;margin:6px 0;
  cursor:pointer
}
.meta{display:flex;gap:10px;font-size:14px;opacity:.9;margin:8px 0}
.price{font-size:22px;color:#F2B840;font-weight:700;margin:6px 0}
button{
  width:100%;padding:14px;border:none;border-radius:26px;
  background:#F2B840;color:#06142E;font-weight:800;font-size:16px
}
button:disabled{background:#777}
</style>
</head>

<body>
<div id="map"></div>

<div id="sheet">
  <!-- DÃ©part -->
  <div class="field">
    ğŸ“
    <input id="startInput" placeholder="Position actuelle" />
  </div>

  <!-- Destination -->
  <div class="field">
    ğŸ¯
    <input id="destInput" placeholder="OÃ¹ allez-vous ?" />
  </div>

  <div class="results" id="results"></div>

  <div class="meta">
    <div id="distance"></div>
    <div id="time"></div>
  </div>

  <div class="price" id="price"></div>
  <button id="order" disabled>ğŸš— Commander la course</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* MAP */
const map=L.map('map').setView([-3.3614,29.3599],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

let startPos=null,endPos=null,startMarker,endMarker,route;

/* GÃ©oloc dÃ©part (Uber-like par dÃ©faut) */
navigator.geolocation.getCurrentPosition(p=>{
  startPos=[p.coords.latitude,p.coords.longitude];
  startMarker=L.marker(startPos).addTo(map).bindPopup("DÃ©part").openPopup();
  map.setView(startPos,15);
});

/* Recherche destination (autocomplÃ©tion rÃ©elle) */
const destInput=document.getElementById('destInput');
const results=document.getElementById('results');

destInput.addEventListener('input',()=>{
  const q=destInput.value.trim();
  if(q.length<3){results.innerHTML='';return;}
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`)
    .then(r=>r.json()).then(list=>{
      results.innerHTML='';
      list.slice(0,5).forEach(p=>{
        const d=document.createElement('div');
        d.className='result';
        d.textContent=p.display_name;
        d.onclick=()=>selectDest(+p.lat,+p.lon,p.display_name);
        results.appendChild(d);
      });
    });
});

function selectDest(lat,lng,label){
  endPos=[lat,lng];
  results.innerHTML='';
  destInput.value=label;
  if(endMarker) map.removeLayer(endMarker);
  endMarker=L.marker(endPos).addTo(map).bindPopup("Destination").openPopup();
  map.setView(endPos,15);
  calculate();
}

/* Calcul rÃ©el (OSRM) */
function calculate(){
  if(!startPos||!endPos) return;
  const url=`https://router.project-osrm.org/route/v1/driving/${startPos[1]},${startPos[0]};${endPos[1]},${endPos[0]}?overview=full&geometries=geojson`;
  fetch(url).then(r=>r.json()).then(d=>{
    const r=d.routes[0];
    const km=(r.distance/1000).toFixed(2);
    const min=Math.ceil(r.duration/60);
    document.getElementById('distance').textContent=`ğŸ“ ${km} km`;
    document.getElementById('time').textContent=`â± ${min} min`;
    const price=Math.round(2000 + km*1000); // BIF (exemple)
    document.getElementById('price').textContent=`ğŸ’° ${price.toLocaleString()} BIF`;
    document.getElementById('order').disabled=false;

    if(route) map.removeLayer(route);
    route=L.geoJSON(r.geometry,{style:{color:'#F2B840',weight:5}}).addTo(map);
  });
}

document.getElementById('order').onclick=()=>{
  alert('ğŸš• Course envoyÃ©e aux chauffeurs');
};
</script>
</body>
</html>
