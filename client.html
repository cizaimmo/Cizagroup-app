<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaRide+ ‚Äî Test R√©el</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;
  height:100%;
  font-family:system-ui, Arial;
  background:#06142E;
  color:white;
}

/* MAP */
#map{
  position:absolute;
  inset:0;
}

/* BOUTONS HAUT */
.top-actions{
  position:fixed;
  top:12px;
  left:12px;
  display:flex;
  gap:10px;
  z-index:9999;
}
.action-btn{
  width:42px;
  height:42px;
  border-radius:50%;
  border:2px solid #F2B840;
  background:#06142E;
  color:#F2B840;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

/* PANEL */
.panel{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#0B1D3A;
  border-radius:24px 24px 0 0;
  padding:16px;
  z-index:5000;
}

.panel h3{
  margin:0 0 10px;
  color:#F2B840;
  text-align:center;
}

input{
  width:100%;
  padding:14px;
  margin-bottom:10px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.2);
  background:#06142E;
  color:white;
}

button{
  width:100%;
  padding:15px;
  border:none;
  border-radius:20px;
  font-weight:800;
  font-size:15px;
  cursor:pointer;
}

.calc{
  background:#F2B840;
  color:#06142E;
}

/* LOADING */
.loading{
  pointer-events:none;
  position:relative;
  color:transparent;
}
.loading::after{
  content:"";
  width:22px;
  height:22px;
  border:3px solid rgba(6,20,46,.3);
  border-top:3px solid #06142E;
  border-radius:50%;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  animation:spin .8s linear infinite;
}
@keyframes spin{to{transform:translate(-50%,-50%) rotate(360deg)}}

#result{
  margin-top:10px;
  text-align:center;
}
</style>
</head>

<body>

<div id="map"></div>

<!-- ACTIONS -->
<div class="top-actions">
  <div class="action-btn" onclick="location.href='portail.html'">‚Üê</div>
  <div class="action-btn" onclick="location.reload()">‚ü≥</div>
</div>

<!-- PANEL -->
<div class="panel">
  <h3>üöó Commander une course</h3>

  <input id="from" placeholder="D√©part (ex : Bwiza)">
  <input id="to" placeholder="Destination (ex : Rohero)">

  <button id="calcBtn" class="calc" onclick="calculate()">Calculer le prix</button>

  <div id="result"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* MAP */
const map = L.map("map",{center:[-3.3822,29.3644],zoom:14});
L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);
let routeLine;

/* GEOCODE */
async function geocode(place){
  const r = await fetch(
    "https://nominatim.openstreetmap.org/search?format=json&q=" +
    encodeURIComponent(place + ", Bujumbura, Burundi")
  );
  const d = await r.json();
  if(!d.length) throw "Lieu introuvable";
  return [parseFloat(d[0].lat), parseFloat(d[0].lon)];
}

/* CALCUL */
async function calculate(){
  const btn = document.getElementById("calcBtn");
  const from = document.getElementById("from").value.trim();
  const to = document.getElementById("to").value.trim();

  if(!from || !to){
    alert("Entre le d√©part et la destination");
    return;
  }

  btn.classList.add("loading");

  try{
    const s = await geocode(from);
    const e = await geocode(to);

    const res = await fetch(
      `https://router.project-osrm.org/route/v1/driving/${s[1]},${s[0]};${e[1]},${e[0]}?overview=full&geometries=geojson`
    ).then(r=>r.json());

    const route = res.routes[0];

    if(routeLine) map.removeLayer(routeLine);
    routeLine = L.geoJSON(route.geometry,{
      style:{color:"#F2B840",weight:5}
    }).addTo(map);

    map.fitBounds(routeLine.getBounds(),{padding:[30,30]});

    const km = (route.distance/1000).toFixed(1);
    const price = Math.round(2000 + km*1000);

    document.getElementById("result").innerHTML =
      `üìè ${km} km<br>üí∞ <b>${price.toLocaleString()} BIF</b>`;
  }catch(e){
    alert("Erreur de calcul");
  }

  btn.classList.remove("loading");
}
</script>

</body>
</html>
