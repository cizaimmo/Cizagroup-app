<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaRide+ â€” Commander un trajet</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:system-ui, Arial;
  background:#06142E;
}
#map{height:100%}

/* Bottom Sheet Uber-like */
#sheet{
  position:fixed;
  bottom:12px;
  left:50%;
  transform:translateX(-50%);
  width:94%;
  background:#0B1D3A;
  border-radius:22px;
  padding:16px;
  z-index:1000;
  box-shadow:0 12px 30px rgba(0,0,0,.45);
}

.field{
  background:#122A52;
  border-radius:14px;
  padding:12px;
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
}

.field input{
  width:100%;
  background:transparent;
  border:none;
  outline:none;
  color:white;
  font-size:15px;
}

#suggestions{
  max-height:180px;
  overflow:auto;
  margin-bottom:8px;
}

.suggestion{
  background:#122A52;
  padding:10px;
  border-radius:12px;
  margin-bottom:6px;
  cursor:pointer;
}

.suggestion:hover{
  background:#1A3A6B;
}

.info{
  display:flex;
  justify-content:space-between;
  font-size:15px;
  margin:10px 0;
}

#price{
  color:#F2B840;
  font-weight:bold;
}

button{
  width:100%;
  padding:16px;
  border:none;
  border-radius:30px;
  background:#F2B840;
  color:#06142E;
  font-size:17px;
  font-weight:bold;
}

button:disabled{
  background:#777;
}
</style>
</head>

<body>

<div id="map"></div>

<!-- Bottom Sheet -->
<div id="sheet">
  <div class="field">
    ğŸ“ <input id="start" readonly placeholder="Position actuelle">
  </div>

  <div class="field">
    ğŸ¯ <input id="destination" placeholder="OÃ¹ allez-vous ?">
  </div>

  <div id="suggestions"></div>

  <div class="info">
    <span id="distance"></span>
    <span id="price"></span>
  </div>

  <button id="order" disabled>ğŸš— Commander la course</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ---------------- MAP ---------------- */
const map = L.map('map').setView([-3.3614, 29.3599], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

let startPos=null, endPos=null;
let startMarker=null, endMarker=null;

/* ---------------- DÃ‰PART AUTO ---------------- */
navigator.geolocation.getCurrentPosition(
  pos=>{
    startPos=[pos.coords.latitude, pos.coords.longitude];
    document.getElementById("start").value="Position actuelle";
    startMarker=L.marker(startPos).addTo(map).bindPopup("DÃ©part").openPopup();
    map.setView(startPos,15);
  },
  ()=>alert("Autorisez la localisation"),
  {enableHighAccuracy:true}
);

/* ---------------- DESTINATION (RECHERCHE) ---------------- */
const destInput=document.getElementById("destination");
const suggestions=document.getElementById("suggestions");

destInput.addEventListener("input",()=>{
  const q=destInput.value.trim();
  if(q.length<3){
    suggestions.innerHTML="";
    return;
  }

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`)
    .then(r=>r.json())
    .then(data=>{
      suggestions.innerHTML="";
      data.slice(0,5).forEach(p=>{
        const div=document.createElement("div");
        div.className="suggestion";
        div.textContent=p.display_name;
        div.onclick=()=>{
          setDestination(p.lat, p.lon, p.display_name);
        };
        suggestions.appendChild(div);
      });
    });
});

/* ---------------- DESTINATION (CLIC CARTE - OPTIONNEL) ---------------- */
map.on("click",e=>{
  setDestination(e.latlng.lat, e.latlng.lng, "Destination sÃ©lectionnÃ©e");
});

/* ---------------- SET DESTINATION ---------------- */
function setDestination(lat,lng,label){
  endPos=[parseFloat(lat), parseFloat(lng)];
  destInput.value=label;
  suggestions.innerHTML="";

  if(endMarker) map.removeLayer(endMarker);
  endMarker=L.marker(endPos).addTo(map).bindPopup("Destination").openPopup();

  map.setView(endPos,15);
  calculate();
}

/* ---------------- CALCUL DISTANCE + PRIX ---------------- */
function calculate(){
  if(!startPos || !endPos) return;

  const dx=startPos[0]-endPos[0];
  const dy=startPos[1]-endPos[1];
  const km=(Math.sqrt(dx*dx+dy*dy)*111).toFixed(2);

  document.getElementById("distance").textContent="ğŸ“ "+km+" km";

  const price=Math.round(2000 + km*1000);
  document.getElementById("price").textContent="ğŸ’° "+price+" BIF";

  document.getElementById("order").disabled=false;
}

/* ---------------- COMMANDER ---------------- */
document.getElementById("order").onclick=()=>{
  alert("ğŸš• Course envoyÃ©e (test)");
};
</script>

</body>
</html>
