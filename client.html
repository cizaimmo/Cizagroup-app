<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaRide+ â€” Commander une course</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:system-ui, Arial;
  background:#06142E;
}
#map{height:100%}

/* Bottom sheet */
#sheet{
  position:fixed;
  bottom:12px;
  left:50%;
  transform:translateX(-50%);
  width:94%;
  background:#0B1D3A;
  border-radius:22px;
  padding:16px;
  z-index:1000;
  box-shadow:0 12px 30px rgba(0,0,0,.45);
}

.field{
  background:#122A52;
  border-radius:14px;
  padding:12px;
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
}

.field input{
  width:100%;
  background:transparent;
  border:none;
  outline:none;
  color:white;
  font-size:15px;
}

.info{
  display:flex;
  justify-content:space-between;
  margin:10px 0;
  font-size:15px;
}

#price{
  color:#F2B840;
  font-weight:bold;
}

button{
  width:100%;
  padding:16px;
  border:none;
  border-radius:30px;
  background:#F2B840;
  color:#06142E;
  font-size:17px;
  font-weight:bold;
  margin-top:8px;
}

button.secondary{
  background:#444;
  color:white;
}

button:disabled{
  background:#777;
}

.signature{
  margin-top:14px;
  text-align:center;
  font-size:12px;
  letter-spacing:1px;
  opacity:0.6;
  color:white;
}
.signature b{color:#F2B840}
</style>
</head>

<body>

<div id="map"></div>

<div id="sheet">

  <div class="field">
    ğŸ“ <input id="startInput" placeholder="DÃ©part (ex : Kanyosha)">
  </div>

  <div class="field">
    ğŸ¯ <input id="destInput" placeholder="Destination (ex : Rohero)">
  </div>

  <button class="secondary" id="calcBtn">ğŸ“ Calculer le prix</button>

  <div class="info">
    <span id="distance"></span>
    <span id="price"></span>
  </div>

  <button id="orderBtn" disabled>ğŸš— Commander la course</button>

  <div class="signature">
    Design signed by <b>CIZA GROUP</b>
  </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ---------------- MAP ---------------- */
const map = L.map('map').setView([-3.3614, 29.3599], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

let routeLine = null;
let startMarker = null;
let endMarker = null;

/* ---------------- GÃ‰OCODAGE SIMPLE (QUARTIERS) ---------------- */
function geocode(place){
  return fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place + ", Bujumbura")}`)
    .then(r=>r.json())
    .then(d=>{
      if(!d.length) throw "Lieu introuvable";
      return [parseFloat(d[0].lat), parseFloat(d[0].lon)];
    });
}

/* ---------------- CALCUL + TRACÃ‰ ---------------- */
document.getElementById("calcBtn").onclick = async ()=>{
  const startName = document.getElementById("startInput").value.trim();
  const destName  = document.getElementById("destInput").value.trim();

  if(!startName || !destName){
    alert("Veuillez entrer le dÃ©part et la destination");
    return;
  }

  try{
    const startPos = await geocode(startName);
    const endPos   = await geocode(destName);

    if(startMarker) map.removeLayer(startMarker);
    if(endMarker) map.removeLayer(endMarker);
    if(routeLine) map.removeLayer(routeLine);

    startMarker = L.marker(startPos).addTo(map).bindPopup("DÃ©part");
    endMarker   = L.marker(endPos).addTo(map).bindPopup("Destination");

    const url = `https://router.project-osrm.org/route/v1/driving/${startPos[1]},${startPos[0]};${endPos[1]},${endPos[0]}?overview=full&geometries=geojson`;
    const res = await fetch(url).then(r=>r.json());

    const route = res.routes[0];
    const km = (route.distance / 1000).toFixed(1);
    const price = 2000 + km * 1000;

    routeLine = L.geoJSON(route.geometry,{
      style:{color:"#F2B840", weight:5}
    }).addTo(map);

    map.fitBounds(routeLine.getBounds(), {padding:[40,40]});

    document.getElementById("distance").textContent =
      "ğŸ“ Distance estimÃ©e : " + km + " km";

    document.getElementById("price").textContent =
      "ğŸ’° Prix estimÃ© : " + price.toLocaleString() + " BIF";

    document.getElementById("orderBtn").disabled = false;

  }catch(e){
    alert("Impossible de tracer le trajet");
  }
};

/* ---------------- COMMANDER ---------------- */
document.getElementById("orderBtn").onclick = ()=>{
  alert("ğŸš• Course envoyÃ©e au chauffeur");
};
</script>

</body>
</html>
