<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CizaRide+ Driver</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:system-ui,Arial;background:#06142E;color:white}

/* HEADER */
header{
  position:fixed;top:0;left:0;width:100%;
  height:56px;z-index:1001;
  background:#0B1D3A;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 14px;border-bottom:1px solid rgba(242,184,64,.4);
}
header .brand{font-weight:800;color:#F2B840}
header .status{font-size:13px}
header .offline{color:#ff4d4d}
header .online{color:#00ff88}

/* MAP */
#map{position:absolute;top:56px;bottom:0;width:100%}

/* CONTROLS */
#centerBtn{
  position:fixed;bottom:90px;right:18px;
  width:48px;height:48px;border-radius:50%;
  border:none;background:#06142E;color:#F2B840;
  font-size:22px;box-shadow:0 0 12px rgba(0,0,0,.4);
  z-index:1000;cursor:pointer;
}

/* INFO BAR */
#info{
  position:fixed;top:60px;left:10px;z-index:1000;
  background:rgba(6,20,46,.9);
  border:1px solid rgba(242,184,64,.4);
  border-radius:12px;padding:8px 10px;
  font-size:12px;
}

/* ZOOM STYLE */
.leaflet-control-zoom a{
  background:rgba(6,20,46,.9);
  color:#F2B840;
  border:1px solid rgba(242,184,64,.6);
}
</style>
</head>

<body>

<header>
  <div class="brand">CizaRide+ Driver</div>
  <div class="status offline" id="onlineStatus">‚óè Hors ligne</div>
</header>

<div id="info">
  <div id="gpsStatus">üü° GPS‚Ä¶</div>
  <div id="zone">üìç Zone : --</div>
</div>

<div id="map"></div>

<button id="centerBtn">üìç</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===============================
   MAP ‚Äì BURUNDI (BUJUMBURA)
================================ */
const map = L.map('map', {
  center: [-3.3822, 29.3644],
  zoom: 13,
  zoomControl:false,
  minZoom:12,
  maxZoom:18,
  scrollWheelZoom:false
});

L.tileLayer(
  'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',
  { attribution:'¬© OpenStreetMap', maxZoom:19 }
).addTo(map);

L.control.zoom({position:'bottomright'}).addTo(map);

map.setMaxBounds([
  [-4.5, 28.8],
  [-2.3, 30.9]
]);

/* ===============================
   GPS + MARKER
================================ */
let driverMarker;

navigator.geolocation.watchPosition(
  pos=>{
    document.getElementById("gpsStatus").innerText="üü¢ GPS OK";
    document.getElementById("onlineStatus").innerHTML="‚óè En ligne";
    document.getElementById("onlineStatus").className="status online";

    const lat=pos.coords.latitude;
    const lng=pos.coords.longitude;

    if(!driverMarker){
      driverMarker=L.marker([lat,lng]).addTo(map);
      map.setView([lat,lng],14);
    }else{
      driverMarker.setLatLng([lat,lng]);
    }
    updateZone(lat,lng);
  },
  ()=>{
    document.getElementById("gpsStatus").innerText="üî¥ GPS faible";
  },
  {enableHighAccuracy:true}
);

/* ===============================
   RECENTER BUTTON
================================ */
document.getElementById("centerBtn").onclick=()=>{
  if(driverMarker){
    map.setView(driverMarker.getLatLng(),15);
  }
};

/* ===============================
   ZONE (QUARTIER)
================================ */
async function updateZone(lat,lng){
  try{
    const r=await fetch(
      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`
    );
    const d=await r.json();
    document.getElementById("zone").innerText=
      "üìç Zone : "+(d.address.suburb||d.address.city||"Bujumbura");
  }catch{}
}
</script>

</body>
</html>
