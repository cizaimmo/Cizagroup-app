<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CIZA GROUP â€” Dashboard</title>
<link rel="icon" href="logotransparent.png">

<style>
body{
    margin:0;
    background:#06142E;
    color:white;
    font-family:Arial, sans-serif;
}
header{
    padding:20px;
    text-align:center;
    border-bottom:1px solid #12335C;
}
header img{ width:90px; }
header h2{ color:#F2B840; margin:10px 0 0; }

.container{
    max-width:900px;
    margin:auto;
    padding:25px;
}
.card{
    background:#0B1C34;
    border:1px solid #12335C;
    border-radius:14px;
    padding:20px;
    margin-bottom:20px;
}
.card h3{ color:#F2B840; margin-top:0; }

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:15px;
}
.service{
    background:#0B1C34;
    border:1px solid #12335C;
    border-radius:14px;
    padding:18px;
    text-align:center;
    cursor:pointer;
}
.service:hover{ border-color:#F2B840; }

button{
    padding:12px 22px;
    background:#c1121f;
    border:none;
    border-radius:8px;
    color:white;
    font-weight:bold;
    cursor:pointer;
}
</style>
</head>

<body>

<header>
    <img src="logotransparent.png">
    <h2>Dashboard CIZA GROUP</h2>
</header>

<div class="container">

    <!-- PROFIL -->
    <div class="card">
        <h3>ğŸ‘¤ Mon profil</h3>
        <p><b>Email :</b> <span id="email">...</span></p>
        <p><b>Nom :</b> <span id="name">...</span></p>
        <p><b>RÃ´le :</b> <span id="role">...</span></p>
    </div>

    <!-- SERVICES -->
    <div class="card">
        <h3>ğŸš€ Services</h3>
        <div class="grid">
            <div class="service">ğŸš— CizaRide+</div>
            <div class="service">ğŸ’³ CizaPay+</div>
            <div class="service">ğŸ§½ CizaCarWash</div>
            <div class="service">ğŸ¢ CizaImmo</div>
        </div>
    </div>

    <div style="text-align:center">
        <button onclick="logout()">DÃ©connexion</button>
    </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBAiJHbBvRO6cDFpm6C-5mQk6SiTtzcI8o",
  authDomain: "cizagroup-app.firebaseapp.com",
  projectId: "cizagroup-app"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user)=>{
    if(!user){
        window.location.href = "login.html";
        return;
    }

    document.getElementById("email").textContent = user.email;

    // ğŸ” Cherche d'abord dans users
    let ref = doc(db, "users", user.uid);
    let snap = await getDoc(ref);

    // sinon dans drivers
    if(!snap.exists()){
        ref = doc(db, "drivers", user.uid);
        snap = await getDoc(ref);
    }

    if(snap.exists()){
        const d = snap.data();
        document.getElementById("name").textContent =
            (d.firstName || "") + " " + (d.lastName || "");
        document.getElementById("role").textContent = d.role;
    }else{
        document.getElementById("role").textContent = "non dÃ©fini";
    }
});

window.logout = function(){
    signOut(auth).then(()=>{
        window.location.href = "login.html";
    });
};
</script>

</body>
</html>
