<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>CIZA GROUP ‚Äî Connexion</title>
<link rel="icon" href="../logotransparent.png">

<style>
body{
    margin:0;
    background:#06142E;
    color:white;
    font-family:Arial, sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.box{
    width:90%;
    max-width:380px;
    background:#0B1C34;
    padding:30px;
    border-radius:14px;
    border:1px solid #12335C;
    text-align:center;
}
.box img{
    width:100px;
    margin-bottom:15px;
}
.box h2{
    color:#F2B840;
    margin:0 0 20px;
}
input{
    width:100%;
    padding:12px;
    margin-top:10px;
    border:none;
    border-radius:8px;
    background:#112544;
    color:white;
}
button{
    width:100%;
    padding:12px;
    margin-top:14px;
    background:#0b84ff;
    color:white;
    border:none;
    border-radius:8px;
    font-weight:bold;
    cursor:pointer;
}
button:hover{ background:#0466c8; }
a{
    color:#F2B840;
    text-decoration:none;
}
</style>
</head>

<body>

<div class="box">
    <img src="../logotransparent.png" alt="CIZA GROUP">
    <h2>Connexion</h2>

    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Mot de passe">

    <button onclick="loginUser()">Se connecter</button>

    <p style="margin-top:12px;">
        Pas encore de compte ?
        <a href="register.html">Cr√©er un compte</a>
    </p>
</div>

<script type="module">
import { initializeApp } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

/* Firebase config */
const firebaseConfig = {
    apiKey: "AIzaSyBAiJHbBvRO6cDFpm6C-5mQk6SiTtzcI8o",
    authDomain: "cizagroup-app.firebaseapp.com",
    projectId: "cizagroup-app",
    storageBucket: "cizagroup-app.firebasestorage.app",
    messagingSenderId: "930936264084",
    appId: "1:930936264084:web:5395360e54bf17bf492b81"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* Connexion + redirection par r√¥le */
window.loginUser = async function(){
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    if(!email || !password){
        alert("Veuillez remplir tous les champs.");
        return;
    }

    try{
        const cred = await signInWithEmailAndPassword(auth, email, password);
        const uid = cred.user.uid;

        // üîç Cherche dans users
        let ref = doc(db, "users", uid);
        let snap = await getDoc(ref);

        // üîç Sinon dans drivers
        if(!snap.exists()){
            ref = doc(db, "drivers", uid);
            snap = await getDoc(ref);
        }

        if(snap.exists()){
            const role = snap.data().role;

            if(role === "driver"){
                window.location.href = "../driver-dashboard.html";
            }else{
                window.location.href = "../dashboard.html";
            }
        }else{
            alert("R√¥le utilisateur non d√©fini.");
        }

    }catch(err){
        alert("Erreur : " + err.message);
    }
};
</script>

</body>
</html>
